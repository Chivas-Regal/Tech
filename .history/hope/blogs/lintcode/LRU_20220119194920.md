---
icon: page
# è¿™æ˜¯æ–‡ç« çš„æ ‡é¢˜
title: æ–æ³¢é‚£å¥‘æ•°åˆ—
time: 2022-01-19
category: åŠ›æ‰£
tag:
  - æ•°æ®ç»“æ„
  - ç®—æ³•
---


> é¢˜å·ï¼š[134](https://www.lintcode.com/problem/134/)\
> æè¿°ï¼šä¸ºæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç¼“å­˜ç­–ç•¥è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼šè·å–æ•°æ®å’Œå†™å…¥æ•°æ®ã€‚
>
> * get(key) è·å–æ•°æ®ï¼šå¦‚æœç¼“å­˜ä¸­å­˜åœ¨keyï¼Œåˆ™è·å–å…¶æ•°æ®å€¼ï¼ˆé€šå¸¸æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å›-1ã€‚
> * set(key, value) å†™å…¥æ•°æ®ï¼šå¦‚æœkeyè¿˜æ²¡æœ‰åœ¨ç¼“å­˜ä¸­ï¼Œåˆ™è®¾ç½®æˆ–æ’å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜è¾¾åˆ°ä¸Šé™ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ç”¨æ¥è…¾å‡ºç©ºé—²ä½ç½®ã€‚
>
> æœ€ç»ˆ, ä½ éœ€è¦è¿”å›æ¯æ¬¡ get çš„æ•°æ®

## ç®—æ³•æè¿°

```java
/* ç¼“å­˜å®¹é‡ä¸º 2 */
LRUCache cache = new LRUCache(2);
// ä½ å¯ä»¥æŠŠ cache ç†è§£æˆä¸€ä¸ªé˜Ÿåˆ—
// å‡è®¾å·¦è¾¹æ˜¯é˜Ÿå¤´ï¼Œå³è¾¹æ˜¯é˜Ÿå°¾
// æœ€è¿‘ä½¿ç”¨çš„æ’åœ¨é˜Ÿå¤´ï¼Œä¹…æœªä½¿ç”¨çš„æ’åœ¨é˜Ÿå°¾
// åœ†æ‹¬å·è¡¨ç¤ºé”®å€¼å¯¹ (key, val)

cache.set(1, 1);
// cache = [(1, 1)]
cache.set(2, 2);
// cache = [(2, 2), (1, 1)]
cache.get(1);       // è¿”å› 1
// cache = [(1, 1), (2, 2)]
// è§£é‡Šï¼šå› ä¸ºæœ€è¿‘è®¿é—®äº†é”® 1ï¼Œæ‰€ä»¥æå‰è‡³é˜Ÿå¤´
// è¿”å›é”® 1 å¯¹åº”çš„å€¼ 1
cache.set(3, 3);
// cache = [(3, 3), (1, 1)]
// è§£é‡Šï¼šç¼“å­˜å®¹é‡å·²æ»¡ï¼Œéœ€è¦åˆ é™¤å†…å®¹ç©ºå‡ºä½ç½®
// ä¼˜å…ˆåˆ é™¤ä¹…æœªä½¿ç”¨çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯é˜Ÿå°¾çš„æ•°æ®
// ç„¶åæŠŠæ–°çš„æ•°æ®æ’å…¥é˜Ÿå¤´
cache.get(2);       // è¿”å› -1 (æœªæ‰¾åˆ°)
// cache = [(3, 3), (1, 1)]
// è§£é‡Šï¼šcache ä¸­ä¸å­˜åœ¨é”®ä¸º 2 çš„æ•°æ®
cache.set(1, 4);    
// cache = [(1, 4), (3, 3)]
// è§£é‡Šï¼šé”® 1 å·²å­˜åœ¨ï¼ŒæŠŠåŸå§‹å€¼ 1 è¦†ç›–ä¸º 4
// ä¸è¦å¿˜äº†ä¹Ÿè¦å°†é”®å€¼å¯¹æå‰åˆ°é˜Ÿå¤´
```

## ç®—æ³•è®¾è®¡

åˆ†æä¸Šé¢çš„æ“ä½œè¿‡ç¨‹ï¼Œè¦è®© set å’Œ get æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡º cache è¿™ä¸ªæ•°æ®ç»“æ„å¿…è¦çš„æ¡ä»¶ï¼šæŸ¥æ‰¾å¿«ï¼Œæ’å…¥å¿«ï¼Œåˆ é™¤å¿«ï¼Œæœ‰é¡ºåºä¹‹åˆ†ã€‚

å› ä¸ºæ˜¾ç„¶ cache å¿…é¡»æœ‰é¡ºåºä¹‹åˆ†ï¼Œä»¥åŒºåˆ†æœ€è¿‘ä½¿ç”¨çš„å’Œä¹…æœªä½¿ç”¨çš„æ•°æ®ï¼›è€Œä¸”æˆ‘ä»¬è¦åœ¨ cache ä¸­æŸ¥æ‰¾é”®æ˜¯å¦å·²å­˜åœ¨ï¼›å¦‚æœå®¹é‡æ»¡äº†è¦åˆ é™¤æœ€åä¸€ä¸ªæ•°æ®ï¼›æ¯æ¬¡è®¿é—®è¿˜è¦æŠŠæ•°æ®æ’å…¥åˆ°é˜Ÿå¤´ã€‚

é‚£ä¹ˆï¼Œä»€ä¹ˆæ•°æ®ç»“æ„åŒæ—¶ç¬¦åˆä¸Šè¿°æ¡ä»¶å‘¢ï¼Ÿå“ˆå¸Œè¡¨æŸ¥æ‰¾å¿«ï¼Œä½†æ˜¯æ•°æ®æ— å›ºå®šé¡ºåºï¼›é“¾è¡¨æœ‰é¡ºåºä¹‹åˆ†ï¼Œæ’å…¥åˆ é™¤å¿«ï¼Œä½†æ˜¯æŸ¥æ‰¾æ…¢ã€‚æ‰€ä»¥ç»“åˆä¸€ä¸‹ï¼Œå½¢æˆä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼šå“ˆå¸Œé“¾è¡¨ã€‚

LRU ç¼“å­˜ç®—æ³•çš„æ ¸å¿ƒæ•°æ®ç»“æ„å°±æ˜¯å“ˆå¸Œé“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨çš„ç»“åˆä½“ã€‚è¿™ä¸ªæ•°æ®ç»“æ„é•¿è¿™æ ·ï¼š

![](https://gitee.com/biliit/pic-go/raw/master/202201131455479.png)

> åŒé“¾è¡¨å¯ä»¥ä¿è¯å¯¹é“¾è¡¨æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`

## ç®—æ³•å®ç°

åŒé“¾è¡¨ç»“ç‚¹ç±»å‹

```java
class Node {
    public int key, val;
    public Node next, prev;
    public Node(int k, int v) {
        this.key = k;
        this.val = v;
    }
}
```

åŒé“¾è¡¨çš„åŸºæœ¬ `API`

```java
class DoubleList {  
    // åœ¨é“¾è¡¨å¤´éƒ¨æ·»åŠ èŠ‚ç‚¹ x
    public void addFirst(Node x);

    // åˆ é™¤é“¾è¡¨ä¸­çš„ x èŠ‚ç‚¹ï¼ˆx ä¸€å®šå­˜åœ¨ï¼‰
    public void remove(Node x);

    // åˆ é™¤é“¾è¡¨ä¸­æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›è¯¥èŠ‚ç‚¹
    public Node removeLast();

    // è¿”å›é“¾è¡¨é•¿åº¦
    public int size();
}
```

åœ¨ `LRU` ç®—æ³•ä¸­æŠŠåŒé“¾è¡¨å’Œ `HashMap` ç»“åˆèµ·æ¥

**ä¼ªä»£ç **

```java
HashMap<Interger, Node> map;

DoubleList cache;

int get(int key) {
    if (key ä¸å­˜åœ¨) {
        return -1;
    } else {
        // å°†æ•°æ® (key, val) æåˆ°è¡¨å¤´ï¼›
        return val;
    }
}

void put(int key, int val) {
    Node x = new Node(key, val);
    if (key å·²å­˜åœ¨) {
        // æŠŠæ—§çš„æ•°æ®åˆ é™¤
        // å°†æ–°çš„ç»“ç‚¹ x æ’å…¥åˆ°å¼€å¤´
    } else {
        if (cache å·²æ»¡) {
            // åˆ é™¤é“¾è¡¨çš„æœ€åä¸€ä¸ªæ•°æ®è…¾ä½ç½®
            // åˆ é™¤ map ä¸­æ˜ å°„åˆ°è¯¥æ•°æ®çš„é”®
        }
        // å°†æ–°èŠ‚ç‚¹ x æ’å…¥åˆ°è¡¨å¤´
        // map ä¸­æ–°å»º key å¯¹æ–°èŠ‚ç‚¹ x çš„æ˜ å°„
    }
}
```

**å°†ä¸Šè¿°çš„é€»è¾‘ï¼Œç¿»è¯‘æˆä»£ç **

```java
class LRUCache {
    // key -> Node(key, val)
    private HashMap<Integer, Node> map;
    // Node(k1, v1) <-> Node(k2, v2)
    private DoubleList cache;
    // ç¼“å­˜å®¹é‡
    private int capacity;

    public LRUCache(int capacity) {
        this.capacity = capacity;
        map = new HashMap<>();
        cache = new DoubleList();
    }

    public int get(int key) {
        if (!map.containsKey(key))
            return -1;
        int val = map.get(key).val;
        set(key, val);
        return val;
    }

    public int set(int key, int val) {
        // å…ˆåˆå§‹åŒ–èŠ‚ç‚¹
        Node x = new Node(key, val);

        if (map.containsKey(key)) {
            // åˆ é™¤æ—§èŠ‚ç‚¹ï¼Œ æ–°èŠ‚ç‚¹æ’åˆ°å¤´éƒ¨
            cache.remove(map.get(key));
            cache.addFirst(x);
            // æ›´æ–° map ä¸­å¯¹åº”çš„æ•°æ®
            map.set(key, x);
        } else {
            if (cap == cache.size()) {
                // åˆ é™¤é“¾è¡¨æœ€åçš„ä¸€ä¸ªæ•°æ®
                Node last = cache.removeLast();
                map.remove(last.key);
            }
            // ç›´æ¥æ·»åŠ åˆ°å¤´éƒ¨
            chache.addFirst(x);
            map.put(key, x);
        }
    }
}
```

## çˆ¬å°é˜¶é€’å½’ç®—æ³•

### ç®—æ³•è®¾è®¡

å¾ˆé•¿æ—¶é—´æ²¡æœ‰æ¥è§¦é€’å½’äº†ï¼Œæ˜¨å¤©çªç„¶é‡åˆ°æ€ç»´ä¸€ä¸‹æ²¡æœ‰è½¬è¿‡æ¥ğŸ˜­

1. n=0 å’Œ n=1 çš„æ—¶å€™ å¹¶æ²¡æœ‰å…¶ä»–å¯é€‰æ‹©çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾—å‡ºf(0)=0;f(1)=1;

2. n>=2æ—¶æƒ…å†µå°±å˜å¤æ‚èµ·æ¥ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å¯ä»¥æ“ä½œçš„æ­¥éª¤ä¹Ÿå°±2ç§ï¼Œä¹Ÿå°±æ˜¯èµ°1æ­¥(n-1)ä¸èµ°2æ­¥(n-2)ã€‚æ‰€ä»¥å¯ä»¥å¾—åˆ°f(n)=f(n-1)+f(n-2);ä»å½“å‰çŠ¶æ€è½¬ä¸ºä¸‹ä¸€çŠ¶æ€çš„é€šç”¨ç®—æ³•æ—¢å¯ã€‚

3. éªŒè¯ï¼Œä½¿ç”¨2ä»¥ä¸Šçš„æ•°å­—éªŒè¯å‡ æ¬¡ã€‚

### ç®—æ³•å®ç°

ä½¿ç”¨é€’å½’çš„æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯ç©·ä¸¾æ‰€æœ‰å¯ä»¥å®ç°çš„

```java
public static int f(int n){
    if(n<=2) return n;
    int x = f(n-1)+f(n-2);
    return x;
}
```

é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä½¿ç”¨å¾ªç¯çš„æ–¹æ³•å®ç°äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿™ç§æ–¹æ³•ç›¸è¾ƒäºé€’å½’æ•ˆç‡æ›´é«˜æ²¡æœ‰å†—ä½™è®¡ç®—

```java
public static int f(int n){
    if(n<=2) return n;
    int first=1,second=2;
    int third=0;
    for(int i=3;i<=n;i++){
        third = first+second;
        first = second;
        second = third;
    }
    return third;
}
```
